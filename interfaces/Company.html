<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>renmoney-application documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">renmoney-application documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Company</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/@page/create/loan/employment-details/employment-details.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#address">address</a>
                                </li>
                                <li>
                                        <a href="#encodedKey">encodedKey</a>
                                </li>
                                <li>
                                        <a href="#name">name</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="address"></a>
                                        <span class="name"><b>address</b><a href="#address"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>address:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="encodedKey"></a>
                                        <span class="name"><b>encodedKey</b><a href="#encodedKey"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>encodedKey:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name"><b>name</b><a href="#name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { NgForm } from &#x27;@angular/forms&#x27;;
import { LoanService } from &#x27;src/app/@core/loan.service&#x27;;
import { Component, OnInit, Input, TemplateRef, EventEmitter, Output } from &#x27;@angular/core&#x27;;
import { Client } from &#x27;src/app/@model/client&#x27;;
import { BsModalService, BsModalRef } from &quot;ngx-bootstrap/modal&quot;;
import { RenConfig } from &#x27;../loan-calculator/loan-config-mockdata&#x27;;
import { DashboardService } from &#x27;src/app/@core/dashboard.service&#x27;;
import { ToastrService } from &#x27;ngx-toastr&#x27;;
import { TypeaheadMatch } from &#x27;ngx-bootstrap/typeahead/typeahead-match.class&#x27;;

import * as moment from &#x27;moment&#x27;;
import { noop, Observable, Observer, of } from &#x27;rxjs&#x27;;
import { map, switchMap, tap } from &#x27;rxjs/operators&#x27;;
import { HttpClient } from &#x27;@angular/common/http&#x27;;
import { environment } from &#x27;src/environments/environment&#x27;;
import { PageChangedEvent } from &#x27;ngx-bootstrap/pagination&#x27;;
import { error } from &#x27;protractor&#x27;;
import { DialogBoxComponent } from &#x27;src/app/@page/shared/dialog-box/dialog-box.component&#x27;;



interface Company {
    address: string;
    name: string;
    encodedKey: string;
}
interface CompanySearchResponse {
    status: string;
    code: string;
    message: string;
    data: Company[];
}



@Component({
    selector: &#x27;app-employment-details&#x27;,
    templateUrl: &#x27;./employment-details.component.html&#x27;,
    styleUrls: [&#x27;../../../invest/plan-name/plan-name.component.scss&#x27;, &#x27;../../../single-view/complete/complete.component.scss&#x27;, &#x27;./employment-details.component.scss&#x27;]
})
export class EmploymentDetailsComponent implements OnInit {


    @Input() client: Client;
    @Output() done: EventEmitter&lt;boolean&gt; &#x3D; new EventEmitter&lt;boolean&gt;();
    bsConfig &#x3D; { dateInputFormat: &quot;MMMM Do YYYY&quot;, adaptivePosition: true };

    company: string;
    industries: string[];
    config: any;
    sectors: any[] &#x3D; [];
    industriesForBusinessSector: any[] &#x3D; [];
    states: { name: string; code: string }[];
    LGAs: { name: string }[];
    selectedOption: any;
    industry: string &#x3D; &#x27;&#x27;;
    employer: string;
    newCompanyId: any;

    totalRecords: any;
    page: any &#x3D; 1;

    matchesFound: boolean &#x3D; false;
    companyMatches: any[];
    returnedArray: any[];
    companyNameMatched: string &#x3D; &#x27;&#x27;;
    searchedCompanyName: string;


    dateOfEmployment;

    typeaheadLoading: boolean;
    typeaheadNoResults: boolean;
    noResult: boolean &#x3D; false;

    businessSector: string &#x3D; &#x27;&#x27;;
    lga: string &#x3D; &#x27;&#x27;;
    companyName: string;
    companyType: string &#x3D; &#x27;&#x27;;
    companyIndustry: string &#x3D; &#x27;&#x27;;
    state: any &#x3D; &#x27;&#x27;;
    companyAddress: string;
    loading: boolean &#x3D; false;
    newLga: string &#x3D; &#x27;&#x27;;
    newState: string &#x3D; &#x27;&#x27;;



    companies$: Observable&lt;Company[]&gt;;


    companies: any[];
    public modalRef: BsModalRef;
    noCompany: boolean &#x3D; false;
    companyTypes &#x3D; [
        &quot;Private Limited Liability Company (LTD)&quot;,
        &quot;Public Limited Liability Company (PLC)&quot;,
        &quot;Partnership&quot;,
        &quot;Corporative, Credit and Thrift Society&quot;,
        &quot;Club or Society&quot;
    ]
    dateFromCalender: any &#x3D; &quot;&quot;;





    constructor(private loanService: LoanService, private modalService: BsModalService, private dashboardService: DashboardService, private toastr: ToastrService, private httpClient: HttpClient) {
        this.checkCompany();
    }

    ngOnInit(): void {

        this.config &#x3D; this.dashboardService.getConfigLocally();
        this.getIndustries();
        this.getSectors();
        this.getSupportedStates();
    }

    getIndustries() {
        this.industries &#x3D; this.config.industries;

    }

    getBusinessSectors(sector) {
        this.loanService.getIndustry(sector).subscribe((data: any) &#x3D;&gt; {
            this.industriesForBusinessSector &#x3D; data.data;
        }, error &#x3D;&gt; {
            this.toastr.error(error.message);
        })
    }

    getSectors() {
        this.loanService.getAllSectors().subscribe((data: any) &#x3D;&gt; {
            this.sectors &#x3D; data.data;
        }, error &#x3D;&gt; {
            this.toastr.error(error.message);
        })
    }

    getSupportedStates() {
        this.loanService.getEmployerStates()
            .subscribe(data &#x3D;&gt; {
                this.states &#x3D; data.data;
            }, error &#x3D;&gt; {
                this.toastr.error(error.message);
            })
    }

    getSupportedStateLGAs(stateCode: string) {
        this.loanService.getEmployerLGAsforSelectedState(stateCode)
            .subscribe(data &#x3D;&gt; {
                this.LGAs &#x3D; data.data;
            }, error &#x3D;&gt; {
                this.toastr.error(error.message);
            })
    }

    checkCompany() {
        this.companies$ &#x3D; new Observable((observer: Observer&lt;any&gt;) &#x3D;&gt; {
            observer.next(this.searchedCompanyName);
        }).pipe(switchMap((query: string) &#x3D;&gt; {
            if (query) {
                return this.loanService.getSupportedCompanies(query)
                    .pipe(
                        map((data: CompanySearchResponse) &#x3D;&gt; data &amp;&amp; data.data || []),
                        tap(() &#x3D;&gt; noop, error &#x3D;&gt; {
                            this.toastr.error(error);
                        })
                    );
            }
            return of([]);
        }))
    }

    changeTypeaheadLoading(e: boolean): void {
        this.typeaheadLoading &#x3D; e;
    }

    typeaheadOnSelect(e: TypeaheadMatch): void {
        this.companyName &#x3D; e.item.name;
        this.searchedCompanyName &#x3D; e.item.name;
        this.employer &#x3D; e.item.encodedKey;
        this.modalRef.hide();
    }

    selectThisCompany(company) {
        this.companyName &#x3D; company.title;
        this.searchedCompanyName &#x3D; company.title;
        this.employer &#x3D; company.endcodedKey;
        this.modalRef.hide();
        this.getSectors();
        this.getSupportedStates();
    }

    typeaheadOnSelectMatch(e: TypeaheadMatch) {
        this.companyName &#x3D; e.item.title;
        this.companyNameMatched &#x3D; e.item.title;
        this.employer &#x3D; e.item.encodedkey;
        this.modalRef.hide();
    }

    changeTypeaheadNoResults(e: boolean) {
        this.noResult &#x3D; e;
    }

    setDOB(event) {
        this.dateFromCalender &#x3D; event;
        this.dateOfEmployment &#x3D; this.dateFromCalender;
    }

    callTheFunctions() {
        this.getSectors();
        this.getSupportedStates();
    }

    updateEmployerDetails(form: NgForm) {
        if (this.dateFromCalender) {
            let payload: any &#x3D; {};
            payload.employer &#x3D; this.client.employmentStatus &#x3D;&#x3D;&#x3D; &#x27;Full Time (Private)&#x27; ? this.employer : this.companyName;
            payload.employerAddressLGA &#x3D; this.LGAs.find(x &#x3D;&gt; x.name &#x3D;&#x3D;&#x3D; this.lga).name;
            payload.employerBusinessIndustry &#x3D; form.value.industry;
            payload.dateOfEmployment &#x3D; moment(this.dateOfEmployment, &#x27;DD-MMM-YYYY&#x27;).format(&#x27;YYYY-MM-DD&#x27;);
            payload.employerAddressState &#x3D; this.states.find(x &#x3D;&gt; x.code &#x3D;&#x3D;&#x3D; this.state).name;
            payload.employerBusinessSector &#x3D; this.sectors.find(x &#x3D;&gt; x.encodedKey &#x3D;&#x3D;&#x3D; this.businessSector).name;
            Object.assign(this.client, payload);
            this.done.emit();
        } else {
            this.modalRef &#x3D; this.modalService.show(DialogBoxComponent, {
                backdrop: &quot;static&quot;,
                initialState: {
                    type: &quot;info&quot;,
                    header: &quot;Oops!&quot;,
                    body: &#x60;Please enter a valid date&#x60;,
                    confirmText: &quot;Done&quot;,
                },
            });
        }

    }




    openModal(addCompany: TemplateRef&lt;any&gt;) {
        this.modalRef.hide();
        this.modalRef &#x3D; this.modalService.show(addCompany, { class: &quot;modal-lg&quot; });
    }
    openSearchModal(searchCompany: TemplateRef&lt;any&gt;) {
        this.modalRef &#x3D; this.modalService.show(searchCompany);
    }

    pageChanged(event: PageChangedEvent): void {
        const startItem &#x3D; (event.page - 1) * event.itemsPerPage;
        const endItem &#x3D; event.page * event.itemsPerPage;
        this.returnedArray &#x3D; this.companyMatches.slice(startItem, endItem);
    }



    onSubmitAddCompanyForm(form: NgForm) {
        this.loading &#x3D; true;
        let payload: any &#x3D; {};
        payload.name &#x3D; form.value.companyName;
        payload.address &#x3D; form.value.companyAddress;
        payload.company_type &#x3D; form.value.companyType;
        payload.industry &#x3D; form.value.companyIndustry;
        payload.state &#x3D; form.value.newState;
        payload.lga &#x3D; form.value.newLga;
        payload.hub &#x3D; &#x27;8a13283e4f5197d3014f66091a8f273d&#x27;;
        payload.credit &#x3D; &#x27;credit&#x27;;
        payload.pay_date &#x3D; &#x27;Date&#x27;;
        payload.payroll_day &#x3D; &#x27;26&#x27;;
        payload.weekend_rule_saturday &#x3D; 0;
        payload.weekend_rule_sunday &#x3D; 0;
        payload.public_holiday_rule &#x3D; 0;
        this.loanService.createCompany(payload).subscribe((data: any) &#x3D;&gt; {
            this.loading &#x3D; false;
            if (data.code &#x3D;&#x3D;&#x3D; 2) {
                this.matchesFound &#x3D; true;
                this.companyMatches &#x3D; data.data;
                this.returnedArray &#x3D; this.companyMatches.slice(0, 10);
                this.newCompanyId &#x3D; data.newCompanyId;
            } else {
                this.modalRef.hide();
                this.employer &#x3D; data.data.encodedKey
                this.toastr.success(&#x27;Company successfully added!&#x27;);
            }

        }, error &#x3D;&gt; {
            this.toastr.error(error.message);
            this.loading &#x3D; false;
        })
    }

    addCompanyNotListed() {
        this.loading &#x3D; true;
        this.loanService.addCompany(this.newCompanyId).subscribe(data &#x3D;&gt; {
            this.loading &#x3D; false;
            this.modalRef.hide();
            this.getSectors();
            this.getSupportedStates();
        }, error &#x3D;&gt; {
            this.loading &#x3D; false;
            this.toastr.error(error.error.message);
        })

    }


}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Company.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
